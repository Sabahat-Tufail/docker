(function () { const t = document.createElement("link").relList; if (t && t.supports && t.supports("modulepreload")) return; for (const e of document.querySelectorAll('link[rel="modulepreload"]')) a(e); new MutationObserver(e => { for (const r of e) if (r.type === "childList") for (const s of r.addedNodes) s.tagName === "LINK" && s.rel === "modulepreload" && a(s) }).observe(document, { childList: !0, subtree: !0 }); function o(e) { const r = {}; return e.integrity && (r.integrity = e.integrity), e.referrerPolicy && (r.referrerPolicy = e.referrerPolicy), e.crossOrigin === "use-credentials" ? r.credentials = "include" : e.crossOrigin === "anonymous" ? r.credentials = "omit" : r.credentials = "same-origin", r } function a(e) { if (e.ep) return; e.ep = !0; const r = o(e); fetch(e.href, r) } })(); class f {
    constructor(t) { this.apiUrl = t, this.conversation = JSON.parse(localStorage.getItem("chatHistory") || "[]"), this.createUI(), this.attachEvents(), this.renderChat() } createUI() {
        const t = document.createElement("div"); t.classList.add("chatbot-container"), t.innerHTML = `
            <div class="chat-header">ğŸ’¬ Chatbot</div>
            <div id="chatBox" class="chat-box"></div>
            <form id="chatForm" class="chat-form">
                <input id="userInput" type="text" placeholder="Type your message..." required />
                <button type="submit">Send</button>
            </form>
            <button id="clearChat" class="clear-btn">ğŸ—‘ï¸ New Chat</button>
        `, document.body.appendChild(t); const o = document.createElement("style"); o.textContent = `
            .chatbot-container {
                position: fixed; bottom: 20px; right: 20px;
                width: 350px; background: #fff;
                border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                padding: 10px; z-index: 9999;
                font-family: Arial, sans-serif;
            }
            .chat-header { text-align: center; font-weight: bold; margin-bottom: 10px; }
            .chat-box { height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 8px; background: #fafafa; }
            .message { padding: 6px 10px; margin-bottom: 8px; border-radius: 8px; max-width: 80%; word-wrap: break-word; }
            .user { background-color: #d1e7ff; margin-left: auto; }
            .assistant { background-color: #e9ecef; margin-right: auto; }
            .chat-form { display: flex; margin-top: 10px; }
            .chat-form input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px 0 0 6px; }
            .chat-form button { padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 0 6px 6px 0; cursor: pointer; }
            .chat-form button:hover { background: #0056b3; }
            .clear-btn { width: 100%; margin-top: 10px; background: #dc3545; color: white; padding: 8px; border: none; border-radius: 6px; cursor: pointer; }
            .clear-btn:hover { background: #b02a37; }
        `, document.head.appendChild(o), this.chatBox = t.querySelector("#chatBox"), this.chatForm = t.querySelector("#chatForm"), this.userInput = t.querySelector("#userInput"), this.clearChat = t.querySelector("#clearChat")
    } attachEvents() { this.chatForm.addEventListener("submit", t => this.sendMessage(t)), this.clearChat.addEventListener("click", () => { confirm("Clear chat?") && (localStorage.removeItem("chatHistory"), this.conversation = [], this.renderChat()) }) } renderChat() { this.chatBox.innerHTML = "", this.conversation.forEach(t => { const o = document.createElement("div"); o.classList.add("message", t.role), o.textContent = t.content, this.chatBox.appendChild(o) }), this.chatBox.scrollTop = this.chatBox.scrollHeight } saveChat() { localStorage.setItem("chatHistory", JSON.stringify(this.conversation)) } async sendMessage(t) {
        t.preventDefault(); const o = this.userInput.value.trim(); if (!o) return; this.conversation.push({ role: "user", content: o }), this.saveChat(), this.renderChat(), this.userInput.value = ""; const a = document.createElement("div"); a.classList.add("message", "assistant"), a.textContent = "", this.chatBox.appendChild(a); try {
            const r = (await fetch(`${this.apiUrl}/chat/stream`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ conversation: this.conversation }) })).body.getReader(), s = new TextDecoder; let n = ""; for (; ;) {
                const { value: l, done: p } = await r.read(); if (p) break; const u = s.decode(l, { stream: !0 }).split(`
`).filter(i => i.startsWith("data: ")); for (const i of u) { const c = i.replace("data: ", "").trim(); if (c !== "[DONE]") try { const d = JSON.parse(c).content || ""; d && (n += d, a.textContent = n, this.chatBox.scrollTop = this.chatBox.scrollHeight) } catch { } }
            } this.conversation.push({ role: "assistant", content: n }), this.saveChat(), this.renderChat()
        } catch (e) { console.error("Network Error:", e), a.textContent = "[Network error]" }
    }
} window.addEventListener("load", () => { new f("http://127.0.0.1:8000") });
